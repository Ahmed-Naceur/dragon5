*----
*  TEST CASE TCM67
*  FMAC-M generated homogeneous macrolib
*  1D slab sn electron-photon coupled testcase from ROZ6
*----
*----
*  Define STRUCTURES and MODULES used
*----
MODULE GEO: FMAC: MAC: SNT: ASM: FLU: PSOUR: OUT: DELETE: END: UTL:
       HEAT: ABORT: SOUR: ;
LINKED_LIST  EMACRO EMACRO2 GMACRO GMACRO2 GEOM ETRACK GTRACK SYSTEM
       EFLUX GFLUX ESOUR GSOUR EEDITS GEDITS DEPOS ;
REAL esum DELTA ;
SEQ_ASCII FMAC_M :: FILE './water.txt' ;
*----
*  Set and track the geometry
*----
GEOM := GEO: :: CAR1D 2
           X- VOID  X+ VOID
           MIX 1 2
           MESHX 0.0 0.3 4.0
           SPLITX 30 70
           ;
*GEOM := GEO: :: CAR3D 3 1 1
*            X- VOID X+ VOID
*            Y- VOID Y+ VOID
*            Z- VOID Z+ VOID
*            MIX 2 1 2
*            MESHX 0.0 0.35 0.65 1.0
*            MESHY 0.0 0.5
*            MESHZ 0.0 0.5
*            SPLITX 7 30 7
*            SPLITY 10
*            SPLITZ 10
*            ;
ETRACK := SNT: GEOM ::
      TITLE 'Water slab - isotropic - test module SOUR'
      EDIT 2 MAXR 1000000 DIAM 1 NLIVO SN 16 SCAT 16 EPSI 1.E-5
      MAXI 300 BFPG ;
GTRACK := ETRACK ;
GTRACK := SNT: GTRACK GEOM :: EDIT 2 BTE ;
*----
*  Compute the electron flux
*----
EMACRO := FMAC: FMAC_M ::
  EDIT 2
  PARTICLE BETA
;
EMACRO2 := EMACRO ;
EMACRO := MAC: EMACRO EMACRO2 ::
     MIX 1 1 OLDL
     MIX 2 1 OLDL
     ;
EMACRO2 := DELETE: EMACRO2 ;
REAL qsour := 1.E10 2.0 / $Pi_R / ;
*
ESOUR := SOUR: EMACRO ETRACK GEOM ::
     ISO 1
     XLIM 0.0 0.3
     INTG 1 1.0E10
     ;
*
*
*
ECHO "TEST_SOUR completed" ;
END: ;
