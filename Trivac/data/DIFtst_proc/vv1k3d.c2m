*------------------------
* Benchmark VV1K3D
*
* Reference: A. Bernal, A. Hebert, J. E. Roman, R. Miro and G. Verdu,
* "A Krylov-Schur solution of the eigenvalue problem for the neutron
* diffusion equation discretized with the Raviart-Thomas method," J. of
* Nuclear Science and Technology, Vol. 54, No. 10, 1085-1094 (2017).
*------------------------
LINKED_LIST GEOM XSEC TRACK SYSTEM FLUX RESU ; 
MODULE GEO: MAC: TRIVAT: TRIVAA: FLUD: OUT: END: ABORT: ;
PROCEDURE assertS ;

GEOM := GEO: :: 
                HEXZ 169 10
                EDIT 2
                Z- ZERO Z+ ZERO HBC COMPLETE ZERO
                MESHZ 0. 20. 40. 60. 80. 100. 120. 140. 160. 180. 200.
                SIDE 13.6255 
                SPLITL 1
                MIX 
                ! PLANE 1
                2 1 1 1 1 1 1 1 4 1 4 1 4 1 4 1 4 1 4 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 2
                2 1 1 1 1 1 1 1 4 1 4 1 4 1 4 1 4 1 4 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 3
                2 1 1 1 1 1 1 1 4 1 4 1 4 1 4 1 4 1 4 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 4
                2 1 1 1 1 1 1 1 4 1 4 1 4 1 4 1 4 1 4 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 5
                2 1 1 1 1 1 1 1 4 1 4 1 4 1 4 1 4 1 4 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 6
                2 1 1 1 1 1 1 1 3 1 3 1 3 1 3 1 3 1 3 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 7
                2 1 1 1 1 1 1 1 3 1 3 1 3 1 3 1 3 1 3 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 8
                2 1 1 1 1 1 1 1 3 1 3 1 3 1 3 1 3 1 3 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 9
                2 1 1 1 1 1 1 1 3 1 3 1 3 1 3 1 3 1 3 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ! PLANE 10
                2 1 1 1 1 1 1 1 3 1 3 1 3 1 3 1 3 1 3 3 1 1
                3 1 1 3 1 1 3 1 1 3 1 1 3 1 1 1 1 1 1 1 1
                1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 2 1 4 1 4
                1 2 3 1 4 1 2 3 1 3 2 1 4 1 4 1 2 3 1 3 2 1 4
                5 4 1 3 1 3 5 3 1 3 1 4 5 3 1 3 1 4 5 4 1 3 1 3
                5 3 1 3 1 4 5 4 1 3 1 3 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
                5 5 5 5 5 5 5 5
                ;

XSEC := MAC: :: 
                EDIT 2
                NGRO 2 NIFI 1 NMIX 5
                READ INPUT 
                MIX 1
                   TOTAL 2.48836E-02  6.73049E-2  
                   NUSIGF 4.81619E-3 8.46154E-2  
                   DIFF   1.38320 3.86277E-1  
                   CHI 1. 0.
                   SCAT 1 1 0.
                        1 1 1.64977E-2
                MIX 2
                   TOTAL 2.62865E-02  8.10328E-2 
                   NUSIGF  4.66953E-3 8.52264E-2 
                   DIFF    1.38299  3.89403E-1 
                   CHI 1. 0.
                   SCAT 1 1 0.
                        1 1 1.47315E-2    
                MIX 3
                   TOTAL  2.45662E-02 8.44801E-2 
                   NUSIGF  6.04889E-3  1.19428E-1 
                   DIFF    1.39522  3.86225E-1  
                   CHI 1. 0.
                   SCAT 1 1 0.
                        1 1 1.56219E-2 
                MIX 4
                   TOTAL 2.60117E-02   9.89671E-2 
                   NUSIGF 5.91507E-3 1.20497E-1  
                   DIFF   1.39446  3.87723E-1   
                   CHI 1. 0.
                   SCAT 1 1 0.
                        1 1 1.40185E-2 
                MIX 5
                   TOTAL 2.46141E-02  8.93878E-2
                   NUSIGF 6.40256E-3 1.29281E-1 
                   DIFF   1.39506 3.84492E-1  
                   CHI 1. 0.
                   SCAT 1 1 0.
                        1 1 1.54981E-2
                   ;

TRACK := TRIVAT: GEOM ::
               EDIT 2
               TITL 'VV1K3D'
               MAXR 10000 DUAL 2 1
               ;

SYSTEM := TRIVAA: XSEC TRACK :: EDIT 3 ;

FLUX := FLUD: SYSTEM TRACK :: 
                EDIT 2 ADJ IRAM 3 6 EXTE 30 1.0E-8
                ;  

RESU := OUT: FLUX SYSTEM TRACK XSEC GEOM :: 
                 EDIT 2
                 MODE 1 POWR 1.0 INTG MIX
                 ;

assertS FLUX :: 'K-EFFECTIVE' 1 1.005450 ;
ECHO "test vv1k3d completed" ;
END: ;
