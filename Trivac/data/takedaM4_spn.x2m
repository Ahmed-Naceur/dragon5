*------------------------
* Benchmark Takeda Model 4 Case 1, rods withdraw
*
* Author : Charlotte Bay
* Date : October 2012
*------------------------
LINKED_LIST  HEX3D TRACK MACRO SYSTEM FLUX EDIT ;
MODULE  UTL: GEO: TRIVAT: MAC: TRIVAA: FLUD: OUT: GREP: END: ;
REAL  Keff ;
PROCEDURE assertS ;
*----
*  Input geometry
*----
HEX3D := GEO: :: HEXZ  169 5
       EDIT 2
       HBC  COMPLETE  VOID
       SIDE 7.50
       Z- VOID Z+ VOID
       MESHZ 0.0 45.0 65.0 125.0 145.0 190.0
       SPLITZ 4 2 6 2 4
       SPLITL 2 (*3*2^2 LOSANGES PAR HEXAGONE*)
       MIX
       (* COUCHE N.1 : Steel*)
       2
       2 2 2 2 2 2
       2 2 2 2 2 2 2 2 2 2 2 2
       2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       (* COUCHE N.2 : Axial Blkt & Axial Refl*)
       11
       11 11 11 11 11 11
       10  2 10  2 10  2 10  2 10  2 10  2
       10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7      
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       (* COUCHE N.3 : TestZone*)
       1
       1 1 1 1 1 1
       4 3 4 3 4 3 4 3 4 3 4 3 ! ici 3 = SodiumRod
       5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       (* COUCHE N.4 : Axial Blkt & Axial Refl*)
       11
       11 11 11 11 11 11
       10  3 10  3 10  3 10  3 10  3 10  3
       10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       (* COUCHE N.5 : Steel*)
       2
       2 2 2 2 2 2
       2 3 2 3 2 3 2 3 2 3 2 3
       2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       ;
TRACK := TRIVAT: HEX3D ::
      TITLE 'TEST TAKEDA MODEL 4 CASE 1 (4 GROUPS).'
      EDIT 2 MAXR 40000 DUAL (*THOMAS-RAVIART-SCHNEIDER METHOD*)
                      (*IELEM=*) 2 (*POL PARABOLIQUES*)
                      (*ICOL=*)  3 (*QUADR GAUSS-LEGENDRE*)
      SPN 5
;
*----
*  Input cross sections
*----
MACRO := MAC: ::
    EDIT 2 NGRO 4 NMIX 11 NIFI 1
    READ INPUT
    MIX  1 (*TestZone*)
        TOTAL 1.24526E-1 2.01025E-1 2.86599E-1 3.68772E-1
       NUSIGF 1.79043E-2 1.59961E-2 2.40856E-2 7.33104E-2
          CHI 0.908564   0.087307   0.004129   0.0
         SCAT 1 1                                  1.05964E-1
              2 2                       1.89370E-1 1.12738E-2
              3 3            2.70207E-1 3.64847E-3 1.46192E-4
              4 4 3.18960E-1 1.80479E-3 1.06888E-6 9.62178E-7
    MIX  2 (*Steel*)
        TOTAL 9.83638E-2 1.35140E-1 2.24749E-1 2.83117E-1
         SCAT 1 1                                  9.06050E-2
              2 2                       1.30581E-1 7.42377E-3
              3 3            2.19547E-1 4.35250E-3 1.18163E-4
              4 4 2.80707E-1 4.64594E-3 3.41675E-7 8.25890E-7
    MIX  3 (*SodiumRod*)
        TOTAL 7.27587E-2 1.00218E-1 1.60703E-1 1.51576E-1  
         SCAT 1 1                                  6.63634E-2
              2 2                       9.61236E-2 6.23393E-3
              3 3            1.56016E-1 4.01375E-3 7.02121E-5
              4 4 1.50368E-1 4.49111E-3 1.26939E-7 4.16388E-7
    MIX  4 (*DriverWOMod*)
        TOTAL 1.40226E-1 2.28245E-1 3.25806E-1 4.18327E-1
       NUSIGF 1.59878E-2 1.64446E-2 2.71451E-2 8.45807E-2
          CHI 0.908564   0.087307   0.004129   0.0
         SCAT 1 1                                  1.19887E-1
              2 2                       2.15213E-1 1.30790E-2
              3 3            3.06885E-1 4.00117E-3 1.59938E-4
              4 4 3.60906E-1 1.67341E-3 1.82716E-6 1.07166E-6
    MIX  5 (*DriverWMod*)
        TOTAL 1.41428E-1 2.45394E-1 3.98255E-1 4.35990E-1
       NUSIGF 1.01663E-2 9.46359E-3 1.87325E-2 8.25335E-2
          CHI 0.908564   0.087307   0.004129   0.0
         SCAT 1 1                                  1.14337E-1
              2 2                       2.12006E-1 2.09664E-2
              3 3            3.52093E-1 2.67269E-2 1.39132E-3
              4 4 3.70872E-1 3.29030E-2 1.08186E-3 6.10281E-5
    MIX  6 (*ReflWOMod*)
        TOTAL 1.59346E-1 2.16355E-1 3.48692E-1 6.24249E-1 
         SCAT 1 1                                  1.47969E-1
              2 2                       2.10410E-1 1.06607E-2
              3 3            3.42085E-1 5.46711E-3 2.49956E-4
              4 4 6.19306E-1 5.36879E-3 1.00157E-6 1.82565E-6
    MIX  7 (*ReflWMod*)
        TOTAL 1.39164E-1 2.46993E-1 4.52425E-1 5.36256E-1
         SCAT 1 1                                  1.05911E-1
              2 2                       1.84820E-1 2.96485E-2
              3 3            3.73072E-1 5.91780E-2 3.06502E-3
              4 4 5.12103E-1 7.81326E-2 2.69229E-3 1.41697E-4
    MIX  8 (*KNK1Reflector*)
        TOTAL 1.51644E-1 1.42382E-1 1.65132E-1 8.04845E-1
         SCAT 1 1                                  1.38427E-1
              2 2                       1.37502E-1 1.23901E-2
              3 3            1.60722E-1 4.41927E-3 3.66930E-4
              4 4 7.98932E-1 3.33075E-3 1.63280E-6 1.69036E-6
    MIX  9 (*SodiumSteel*)
        TOTAL 9.65097E-2 9.87095E-2 1.34200E-1 4.12670E-1
         SCAT 1 1                                  8.83550E-2
              2 2                       9.52493E-2 7.73409E-3
              3 3            1.30756E-1 3.22568E-3 1.94719E-4
              4 4 4.09632E-1 2.90481E-3 7.98494E-7 8.89615E-7
    MIX 10 (*AxialReflector*)
        TOTAL 1.32933E-1 1.78531E-1 2.83151E-1 4.62167E-1
         SCAT 1 1                                  1.22995E-1
              2 2                       1.73095E-1 9.41231E-3
              3 3            2.77194E-1 5.09881E-3 1.93791E-4
              4 4 4.58598E-1 5.09601E-3 7.05075E-7 1.39307E-6
    MIX 11 (*AxialBlanket*)
        TOTAL 1.40462E-1 2.25534E-1 3.27065E-1 3.41224E-1
       NUSIGF 2.96101E-3 6.56171E-5 1.14630E-4 4.93483E-4
          CHI 0.908564   0.087307   0.004129   0.0
         SCAT 1 1                                  1.23805E-1
              2 2                       2.17260E-1 1.45483E-2
              3 3            3.17948E-1 6.78885E-3 1.70276E-4
              4 4 3.31281E-1 4.38782E-3 6.04793E-6 9.37083E-7
     ;
*----
*  Flux solution
*----
SYSTEM := TRIVAA: MACRO TRACK ::
      EDIT 2 ;
FLUX := FLUD: SYSTEM TRACK ::
      EDIT 2 ADI 6 EXTE 300 1.0E-6 ;
EDIT := OUT: FLUX HEX3D MACRO TRACK ::
      EDIT 2 INTG 
       (* COUCHE N.1 : Steel*)
       2
       2 2 2 2 2 2
       2 2 2 2 2 2 2 2 2 2 2 2
       2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       (* COUCHE N.2 : Axial Blkt & Axial Refl*)
       11
       11 11 11 11 11 11
       10  2 10  2 10  2 10  2 10  2 10  2
       10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7      
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       (* COUCHE N.3 : TestZone*)
       1
       1 1 1 1 1 1
       4 3 4 3 4 3 4 3 4 3 4 3 ! ici 3 = SodiumRod
       5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5 5
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       (* COUCHE N.4 : Axial Blkt & Axial Refl*)
       11
       11 11 11 11 11 11
       10  3 10  3 10  3 10  3 10  3 10  3
       10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10 10
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       (* COUCHE N.5 : Steel*)
       2
       2 2 2 2 2 2
       2 3 2 3 2 3 2 3 2 3 2 3
       2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
       6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 6 
       7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
       8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 8 
       8 8 8 8 8 8
       9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 9 
       9 9 9 9 9 9 9 9 9 9 9 9
       ;  
GREP: FLUX :: GETVAL 'K-EFFECTIVE' 1 >>Keff<< ;
ECHO "Keff=" Keff ;
assertS FLUX :: 'K-EFFECTIVE' 1 1.090485 ;
ECHO "test takedaM4_spn completed" ;
END: ;
